include "TriggerLibs/NativeLib"
include "LibCOOC"

include "Lib35C394B7_h"

//--------------------------------------------------------------------------------------------------
// Library: Test Lib
//--------------------------------------------------------------------------------------------------
// External Library Initialization
void lib35C394B7_InitLibraries () {
    libNtve_InitVariables();
    libCOOC_InitVariables();
}

// Functions
void lib35C394B7_gf_CM_MasteryKerriganArmyVespeneCostList2 (int lp_player) {
    // Automatic Variable Declarations
    // Implementation
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("Zealot", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("ZealotPurifier", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("ZealotPurifierReviveCorpse", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("SentryPurifier", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("SentryPhasing", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("ImmortalAiur", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("Colossus", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("ColossusPurifier", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("PhoenixPurifier", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("Carrier", lp_player);
    lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore("CarrierAiur", lp_player);
}

void lib35C394B7_gf_MasteryKaraxArmyCostReductionRestore (string lp_unitType, int lp_player) {
    // Automatic Variable Declarations
    // Implementation
    libNtve_gf_CatalogFieldValueModifyBasedOnDefaultValue(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(c_resourceTypeMinerals) + "]", lp_player, 1.3, c_upgradeOperationMultiply);
    libNtve_gf_CatalogFieldValueModifyBasedOnDefaultValue(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(c_resourceTypeVespene) + "]", lp_player, 1.3, c_upgradeOperationMultiply);
}

void lib35C394B7_gf_CM_MasteryKerriganArmyVespeneCostList3 (int lp_player) {
    // Variable Declarations
    int lv_upgradeCount;

    // Automatic Variable Declarations
    // Variable Initialization

    // Implementation
    lv_upgradeCount = TechTreeUpgradeCount(lp_player, "MasteryKaraxUnitCost", c_techCountCompleteOnly);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("SolarForge", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Nexus", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Assimilator", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Gateway", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("WarpGate", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Forge", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Pylon", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("ShieldBattery", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("CyberneticsCore", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("PhotonCannon", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("KhaydarinMonolith", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("TwilightCouncil", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("Stargate", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("RoboticsFacility", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("RoboticsBay", lp_player, lv_upgradeCount);
    lib35C394B7_gf_MasteryKaraxStructureCostReduction("FleetBeacon", lp_player, lv_upgradeCount);
}

void lib35C394B7_gf_MasteryKaraxStructureCostReduction (string lp_unitType, int lp_player, int lp_upgradeCount) {
    // Variable Declarations
    fixed lv_unitCostOriginal;
    fixed lv_UnitVespeneCostReductionPerPoint;
    fixed lv_unitCostReduction;
    int lv_UnitVespeneCostNew;

    // Automatic Variable Declarations
    // Variable Initialization
    lv_UnitVespeneCostReductionPerPoint = 100.0;

    // Implementation
    lv_unitCostOriginal = IntToFixed(CatalogFieldValueGetAsInt(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(1) + "]", lp_player));
    lv_unitCostReduction = (IntToFixed(lp_upgradeCount) * lv_unitCostOriginal);
    lv_unitCostReduction = (lv_unitCostReduction / lv_UnitVespeneCostReductionPerPoint);
    lv_UnitVespeneCostNew = FixedToInt((lv_unitCostOriginal - lv_unitCostReduction));
    CatalogFieldValueSet(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(1) + "]", lp_player, IntToString(lv_UnitVespeneCostNew));
    lv_unitCostOriginal = IntToFixed(CatalogFieldValueGetAsInt(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(0) + "]", lp_player));
    lv_unitCostReduction = (IntToFixed(lp_upgradeCount) * lv_unitCostOriginal);
    lv_unitCostReduction = (lv_unitCostReduction / lv_UnitVespeneCostReductionPerPoint);
    lv_UnitVespeneCostNew = FixedToInt((lv_unitCostOriginal - lv_unitCostReduction));
    CatalogFieldValueSet(c_gameCatalogUnit, lp_unitType, "CostResource[" + IntToString(0) + "]", lp_player, IntToString(lv_UnitVespeneCostNew));
}

// Triggers
//--------------------------------------------------------------------------------------------------
// Trigger: Karax Mastery Swap
//--------------------------------------------------------------------------------------------------
bool lib35C394B7_gt_KaraxMasterySwap_Func (bool testConds, bool runActions) {
    // Variable Declarations
    int lv_p;

    // Automatic Variable Declarations
    // Variable Initialization
    lv_p = EventPlayer();

    // Conditions
    if (testConds) {
        if (!((TriggerIsEnabled(TriggerGetCurrent()) == true))) {
            return false;
        }
    }

    // Actions
    if (!runActions) {
        return true;
    }

    TriggerEnable(TriggerGetCurrent(), false);
    if ((libCOOC_gf_ActiveCommanderForPlayer(lv_p) == "ProtossKarax")) {
        libNtve_gf_UIErrorMessage(PlayerGroupSingle(lv_p), StringExternal("Param/Value/lib_35C394B7_32EF4F78"), SoundLink("Alert_ProtossBuildError", -1));
        lib35C394B7_gf_CM_MasteryKerriganArmyVespeneCostList2(lv_p);
        lib35C394B7_gf_CM_MasteryKerriganArmyVespeneCostList3(lv_p);
    }
    else {
        libNtve_gf_UIErrorMessage(PlayerGroupSingle(lv_p), StringExternal("Param/Value/lib_35C394B7_A095A81F"), SoundLink("Alert_ProtossBuildError", -1));
    }
    return true;
}

//--------------------------------------------------------------------------------------------------
void lib35C394B7_gt_KaraxMasterySwap_Init () {
    lib35C394B7_gt_KaraxMasterySwap = TriggerCreate("lib35C394B7_gt_KaraxMasterySwap_Func");
    TriggerAddEventChatMessage(lib35C394B7_gt_KaraxMasterySwap, c_playerAny, "swap", true);
}

void lib35C394B7_InitTriggers () {
    lib35C394B7_gt_KaraxMasterySwap_Init();
}

//--------------------------------------------------------------------------------------------------
// Library Initialization
//--------------------------------------------------------------------------------------------------
bool lib35C394B7_InitLib_completed = false;

void lib35C394B7_InitLib () {
    if (lib35C394B7_InitLib_completed) {
        return;
    }

    lib35C394B7_InitLib_completed = true;

    lib35C394B7_InitLibraries();
    lib35C394B7_InitTriggers();
}

